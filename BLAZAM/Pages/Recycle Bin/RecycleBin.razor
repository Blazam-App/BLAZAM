@page "/recyclebin"
@inherits AppComponentBase
@attribute [Authorize(Roles = UserRoles.SuperAdmin)]

<AppPageTitle>Recycle Bin</AppPageTitle>

<h3>Recycle Bin</h3>
    <DataGrid TItem="IDirectoryEntryAdapter"
          Data="deletedObjects"
          Responsive
     Virtualize>
        <DataGridCommandColumn />
        <DataGridColumn Field="@nameof(IDirectoryEntryAdapter.ObjectType)" Caption="Type"/>
        <DataGridColumn Field="@nameof(IDirectoryEntryAdapter.CanonicalName)" Caption="Canonical Name"/>
        <DataGridColumn Field="@nameof(IDirectoryEntryAdapter.LastChanged)" Caption="Deleted At" />
        <DataGridColumn>
            <DisplayTemplate>
            <MudButton Color="Color.Primary" Clicked="@(()=>{ Directory.RestoreTombstone(context,context.LastKnownParent); })">Restore</MudButton>

            </DisplayTemplate>


        </DataGridColumn>

    </DataGrid>
    



@code {
    List<IDirectoryEntryAdapter> deletedObjects = new();
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        var search = new ADSearch() { SearchRoot = Directory.GetDeleteObjectsEntry() };
        search.SearchDeleted = true;
        deletedObjects = await search.SearchAsync<DirectoryEntryAdapter, IDirectoryEntryAdapter>();

        await InvokeAsync(StateHasChanged);
    }
}
