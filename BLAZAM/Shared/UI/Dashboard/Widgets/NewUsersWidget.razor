@inherits Widget
@attribute [Authorize]

<MudDataGrid Items="@NewUsers"
              Dense
              Filterable
             FilterMode="DataGridFilterMode.Simple"
             Loading=LoadingData
              Square
             ColumnResizeMode="ResizeMode.Column"
             T="IADUser"
              Virtualize
             RowClass="cursor-pointer"
             RowClick=@GoToUser
             Class="py-0"
             SortMode="SortMode.Single">
    <Columns>
        <PropertyColumn Property="x => x.DisplayName??x.CanonicalName" Title="Display Name" />
        <PropertyColumn Property="x => x.OU.ToPrettyOu()" Title="OU" />
        <PropertyColumn Property="x => x.Created" Title="Creation Date" />

    </Columns>
    <PagerContent>
        <MudDataGridPager T="IADUser" />
    </PagerContent>
</MudDataGrid>

@code {
    List<IADUser> NewUsers
    {
        get => UserStateService.CurrentUserState.Cache.Get<List<IADUser>>(this.GetType());
        set => UserStateService.CurrentUserState.Cache.Set(this.GetType(), value);
    }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        NewUsers = (await Directory.Users.FindNewUsersAsync(false)).Where(u => u.CanRead).ToList();
        LoadingData = false;
        InvokeAsync(StateHasChanged);
    }
    void GoToUser(DataGridRowClickEventArgs<IADUser> args)
    {
        Nav.NavigateTo(args.Item.SearchUri);
    }
}
