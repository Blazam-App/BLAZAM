@inherits AppModalContent


<MudText>Choose OU</MudText>

<OUTreeView @bind-StartingSelectedOU=@StartingOU @bind-SelectedOU=@SelectedOU>
    @*   <NodeContent>
    @context.Name
    </NodeContent>*@
</OUTreeView>




@code {


    #nullable disable warnings

    [Parameter]
    public IDirectoryEntryAdapter DirectoryModel { get; set; }

    IADOrganizationalUnit SelectedOU { get; set; }
    IADOrganizationalUnit StartingOU { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        StartingOU = await DirectoryModel.GetParent();
        Modal.OnYes += MoveTo;
        Modal.YesText = UserLocalization["Move"];
        Modal.Title = "Move To";

        Modal.YesEnabled = ValidateModal;
    }

    async void MoveTo()
    {
        if (await MessageService.Confirm("Are you sure you want to move this " + DirectoryModel.ObjectType.ToString().ToLower() + " to " + SelectedOU.CanonicalName + ". All other unsaved changes will be discarded.", "Confirm move"))
        {


            if (DirectoryModel.MoveTo(SelectedOU))
            {
                SnackBarService.Success(DirectoryModel.CanonicalName + " has been moved to " + SelectedOU.CanonicalName, "Moved");
                await ModelChanged.InvokeAsync();
                Close();
            }
            SnackBarService.Error(DirectoryModel.CanonicalName + " was not able to be moved to " + SelectedOU.CanonicalName, "Move failed");

        }

    }
    protected override bool ValidateModal()
    {
        return SelectedOU != null;
    }

}
