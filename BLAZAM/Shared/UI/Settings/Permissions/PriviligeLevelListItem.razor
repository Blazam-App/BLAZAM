@inherits ValidatedForm
<ListGroupItem Name="@Group?.CanonicalName">
    <Accordion>
        <Collapse Visible="@collapse1Visible">
            <CollapseHeader>
                <MudText Typo ="Typo.h1" Size="HeadingSize.Is5">
                    <MudButton Clicked="@(()=>collapse1Visible = !collapse1Visible)">
                        <Row Width="Width.Is100">
                            <Column ColumnSize="ColumnSize.Is6.OnTablet">
                                @Group?.CanonicalName

                            </Column>
                            <Column ColumnSize="ColumnSize.Is6.OnTablet">
                                <MudSwitch  Checked="Level?.IsSuperAdmin" Disabled>Super User Group</Switch>


                            </Column>
                        </Row>
                            
                    </MudButton>
                </MudText>
            </CollapseHeader>
            <CollapseBody>
                    <Row>
                        <Column ColumnSize="ColumnSize.Is4.OnDesktop">
                            
                                <MudField>
                                    <MudFieldLabel>@AppLocalization["Delgate Name"]</FieldLabel>
                                    
                                        <ADAutoComplete 
                                            SearchObjectType="ActiveDirectoryObjectType.All" 
                                            @bind-SelectedResult=@Group 
                                            CustomResultsFilter="(result)=>result.ObjectType==ActiveDirectoryObjectType.User|| result.ObjectType==ActiveDirectoryObjectType.Group"/>
                                        @*<ADGroupAutoComplete @bind-SelectedGroup="@Group"/>*@
                                    
                                </MudField>

                        </Column>
                        <Column ColumnSize="ColumnSize.Is2.OnDesktop">
                                <MudField>
                                    <MudFieldLabel></FieldLabel>
                                    
                                <MudSwitch Disabled=@(Program.InDebugMode && UserStateService.CurrentUsername !="admin") @bind-Checked="Level.IsSuperAdmin">Super User Group</Switch>


                                    
                                </MudField>

                        </Column>
                        <Column ColumnSize="ColumnSize.Is4.OnDesktop">
                            <MudButton VerticalAlignment="VerticalAlignment.Middle" @onclick="Save" Color="Color.Success">Save Changes</MudButton>
                        </Column>
                    <Column ColumnSize="ColumnSize.Is2.OnDesktop">
                        <AppCloseButton VerticalAlignment="VerticalAlignment.Middle" @onclick="DeletePermissionGroup" Color="Color.Success" />
                    </Column>
                    </Row>

             
            </CollapseBody>
        </Collapse>
    </Accordion>

</ListGroupItem>

@code {

#nullable disable warnings
    IDirectoryEntryAdapter? Group;
    [Parameter]
    public PermissionDelegate Level { get; set; }
    [Parameter]
    public new IDatabaseContext Context { get; set; }


    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        Group = Directory.GetDirectoryModelBySid(Level.DelegateSid);
    }

    bool collapse1Visible = false;

    async Task DeletePermissionGroup()
    {
        Level.DeletedAt = DateTime.UtcNow;
        await Context.SaveChangesAsync();
        await NotificationService.Info("Permission Delegate removed.");

    }
    private async void Save()
    {
        collapse1Visible = false;
        Level.DelegateSid = Group.SID;
        await Context.SaveChangesAsync();
        await InvokeAsync(StateHasChanged);
    }
}
