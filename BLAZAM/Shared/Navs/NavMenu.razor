@using BLAZAM.Server.Background;
@using BLAZAM.Server.Pages;
@using Microsoft.Extensions.Localization;
@using BLAZAM.Common.Data.ActiveDirectory.Interfaces;
@using BLAZAM.Server.Data.Services.Email;
@inherits AppComponentBase
@{
    //string userRole = UserRoles.SuperAdmin + ", " + UserRoles.SearchUsers;
    //string groupRole = UserRoles.SuperAdmin + ", " + UserRoles.SearchGroups;
    //string computerRole = UserRoles.SuperAdmin + ", " + UserRoles.Computers;
    //string ouRole = UserRoles.SuperAdmin + ", " + UserRoles.SearchOUs;
    string createRole = UserRoles.SuperAdmin + ", " + UserRoles.CreateUsers + ", " + UserRoles.CreateGroups + ", " + UserRoles.CreateOUs;
    //string createUser = UserRoles.SuperAdmin + ", " + UserRoles.CreateUsers;
    //string createGroup = UserRoles.SuperAdmin + ", " + UserRoles.CreateGroups;
    //string createOU = UserRoles.SuperAdmin + ", " + UserRoles.CreateOUs;
}




<MudPaper Width="180px" Elevation="0" Class="py-3 mud-theme-dark">
    <MudNavMenu Color="Color.Success" Bordered="true">
        <MudStack Row=true>
            <MudImage Class="app-icon" Src="@StaticAssets.ApplicationIconUri" />
            <MudText Align="Align.Center" Class="align-middle"> @DatabaseCache.ApplicationSettings?.AppAbbreviation</MudText>

        </MudStack>
        <MudNavLink Href="/home" Icon="@Icons.Material.Filled.Dashboard">@AppLocalization["Home"]</MudNavLink>
        <AuthorizeView Context="createContext" Roles=@createRole>
            <MudNavGroup Icon="@Icons.Material.Filled.Create" Title="@AppLocalization["Create"]" Expanded="false" Disabled=@(Monitor.DirectoryConnected != ServiceConnectionState.Up)>
                <MudNavLink Href="/users/create">@AppLocalization["Create User"]</MudNavLink>
                <MudNavLink Href="/groups/create">@AppLocalization["Create Group"]</MudNavLink>
                <MudNavLink Href="/ou/create">@AppLocalization["Create OU"]</MudNavLink>
            </MudNavGroup>
        </AuthorizeView>
        <AuthorizeView Roles=@UserRoles.SuperAdmin>
            <MudNavLink Href="/recyclebin"
                        Icon="@Icons.Material.Filled.DeleteOutline"
                        Disabled=@(Monitor.DirectoryConnected != ServiceConnectionState.Up)>
                @AppLocalization["Recycle Bin"]
            </MudNavLink>

            <MudNavGroup Title="@AppLocalization["Configure"]" Icon="@Icons.Material.Filled.Handyman" Expanded="false">
                <MudNavLink Href="/settings">@AppLocalization["Settings"]</MudNavLink>
                <MudNavLink Href="/permissions">@AppLocalization["Permissions"]</MudNavLink>
                <MudNavLink Href="/fields">@AppLocalization["Fields"]</MudNavLink>
                <MudNavLink Href="/templates">@AppLocalization["Templates"]</MudNavLink>
                <MudNavLink Href="/audit">@AppLocalization["Audit"]</MudNavLink>
            </MudNavGroup>
        </AuthorizeView>


        
    </MudNavMenu>
</MudPaper>





<ScheduledUpdateAnnouncer />


@code {
    private bool collapseNavMenu = true;
    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        Monitor.OnDirectoryConnectionChanged += ((state) => { InvokeAsync(StateHasChanged); });





        InvokeAsync(StateHasChanged);


    }



    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

}
