@inherits Widget
@attribute [Authorize]
<NewEntriesWidgetDataGrid Items="@NewOUs"
                          RowsPerPage="@ItemsPerPage"
                          RowsPerPageChanged="@SetRowsPerPage"
                          RowClick=@GoTo
                          T="IADOrganizationalUnit"
                          Loading=LoadingData />

@code {
    List<IADOrganizationalUnit> NewOUs
    {
        get => CurrentUser.State.Cache.Get<List<IADOrganizationalUnit>>(this.GetType());
        set => CurrentUser.State.Cache.Set(this.GetType(), value);
    }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        CurrentUserDashboardWidgets.OnRefreshWidget += (Widget widget) =>
      {
          if (widget.WidgetType.Equals(WidgetType))
          {
              _ = RefreshData();

          }

      };

        _ = RefreshData();
    }
    async Task RefreshData()
    {
        LoadingData = true;
        await InvokeAsync(StateHasChanged);
        NewOUs = (await Directory.OUs.FindNewOUsAsync()).Where(u => u.CanRead).ToList();

        LoadingData = false;
        await InvokeAsync(StateHasChanged);

    }
    void GoTo(DataGridRowClickEventArgs<IADOrganizationalUnit> args)
    {
        Nav.NavigateTo(args.Item.SearchUri);
    }
}