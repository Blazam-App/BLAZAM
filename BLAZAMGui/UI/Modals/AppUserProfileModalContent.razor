@using BLAZAM.Gui.Helpers;
@using BLAZAM.Gui.Layouts;
@using BLAZAM.Server.Shared.UI.Themes;
@using Microsoft.AspNetCore.Components.Forms;
@inherits AppModalContent

<MudFileUpload T="IBrowserFile"
               FilesChanged="UploadProfilePicture">
    <ButtonTemplate>
        
        <MudButton HtmlTag="label"
                   Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.CloudUpload"
                   for="@context">
            Upload Profile Icon
        </MudButton>
    </ButtonTemplate>
</MudFileUpload>

<MudNavGroup Title="Themes">
    @foreach (var theme in ApplicationTheme.Themes)
    {
        <MudButton OnClick=@(()=>{mainLayout.SetUserTheme(theme);})>
            @theme.Name
        </MudButton>
    }


</MudNavGroup>
<MudSwitch Checked="@CurrentUser.State.UserSettings.DarkMode" CheckedChanged=@((state)=>{mainLayout.SetDarkMode(state);}) Color="Color.Primary" Class="ma-4" T="bool" Label="Toggle Light/Dark Mode" />

@code {
    [CascadingParameter]
    public MainLayout mainLayout { get; set; }
#nullable disable warnings
    async Task UploadProfilePicture(IBrowserFile profilePictureFile)
    {
        var rawBytes = await profilePictureFile.ToByteArrayAsync();

        if (rawBytes != null)
        {
            CurrentUser.State.UserSettings.ProfilePicture = rawBytes.ReizeRawImage(100, true);
            await CurrentUser.State.SaveUserSettings();
        }
    }
}
