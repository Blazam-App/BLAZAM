@inherits AppComponentBase
<MudText Typo="Typo.caption">@ElapsedTime</MudText>

@code {
    [Parameter]
    public IJobStep Step { get; set; }

    Timer? _refreshTimer;
    protected override void OnInitialized()
    {
        base.OnInitialized();

        _refreshTimer = new Timer(UpdateElapsedTime, null, 400, 400);
    }

    public override void Dispose()
    {
        _refreshTimer?.Dispose();
        base.Dispose();
    }
    private async void UpdateElapsedTime(object? state)
    {
        if (Step.Result == JobResult.Running)
        {
            await InvokeAsync(StateHasChanged);
        }
        else if(Step.Result != JobResult.NotRun)
        {
            _refreshTimer?.Dispose();
        }
    }
    private string ElapsedTime
    {
        get
        {
            if (Step.ElapsedTime == null || !Step.ElapsedTime.HasValue) return AppLocalization["Not finished"];
            if (Step.ElapsedTime.Value.TotalSeconds < 1)
            {
                return Step.ElapsedTime.Value.TotalMilliseconds + "ms";   
            }
            return (int)Step.ElapsedTime.Value.TotalMinutes + "m " + (int)(Step.ElapsedTime.Value.TotalMinutes % 1 * 60) + "s";
        }
    }
}